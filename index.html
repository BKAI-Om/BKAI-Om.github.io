<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brahmkumar AI (BKAI) - Your Spiritual Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600&family=Poppins:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F8F7F4; /* Soft, warm off-white */
        }
        .font-serif {
            font-family: 'Playfair Display', serif;
        }
        .chat-bubble-user {
            background-color: #E6ECF5; /* Soft blue */
            color: #334155;
        }
        .chat-bubble-ai {
            background-color: #FFFFFF;
            color: #475569;
            border: 1px solid #E2E8F0;
        }
        .professional-bg {
            background-image: url('https://www.transparenttextures.com/patterns/subtle-white-feathers.png');
        }
        #chat-container::-webkit-scrollbar {
            width: 8px;
        }
        #chat-container::-webkit-scrollbar-track {
            background: #F1F5F9;
        }
        #chat-container::-webkit-scrollbar-thumb {
            background: #CBD5E1;
            border-radius: 4px;
        }
        #chat-container::-webkit-scrollbar-thumb:hover {
            background: #94A3B8;
        }
        .loader {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: inline-block;
            position: relative;
            border: 3px solid;
            border-color: #D4AF37 #D4AF37 transparent transparent; /* Gold color */
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }
        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .message-fade-in {
            animation: fadeIn 0.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
    </style>
</head>
<body class="professional-bg min-h-screen flex items-center justify-center p-2 sm:p-4">

    <div class="w-full max-w-3xl h-[95vh] sm:h-[90vh] bg-white/80 backdrop-blur-xl rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-gray-200/50">
        <!-- Header -->
        <header class="p-5 border-b border-gray-200/80 bg-white/90 flex items-center justify-between flex-shrink-0">
            <div class="flex items-center space-x-4">
                <div class="w-12 h-12 flex items-center justify-center text-white bg-gradient-to-br from-amber-600 to-amber-800 rounded-full shadow-inner">
                    <!-- Lotus Flower Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-lotus">
                        <path d="M8.8 20A6 6 0 0 0 12 14.8a6 6 0 0 0 3.2-5.2c0-1.2-.4-2.3-1.2-3.2"/>
                        <path d="M15.2 20A6 6 0 0 1 12 14.8a6 6 0 0 1-3.2-5.2c0-1.2.4-2.3 1.2-3.2"/>
                        <path d="M2 12h2"/><path d="M20 12h2"/><path d="M12 2v2"/><path d="M12 20v2"/>
                        <path d="M4.9 4.9l1.4 1.4"/><path d="M17.7 17.7l1.4 1.4"/><path d="M4.9 19.1l1.4-1.4"/>
                        <path d="M17.7 6.3l1.4-1.4"/><path d="M12 12s-3.2 2.8-3.2 5.2c0 2.2 1.8 4 4 4s4-1.8 4-4c0-2.4-3.2-5.2-3.2-5.2"/>
                        <path d="M8.8 6.8A6 6 0 0 1 12 10.4a6 6 0 0 1 3.2-3.6"/><path d="M15.2 6.8A6 6 0 0 0 12 10.4a6 6 0 0 0-3.2-3.6"/>
                    </svg>
                </div>
                <div>
                    <h1 class="text-2xl font-serif font-semibold text-slate-800">Brahmkumar AI</h1>
                    <p class="text-sm text-slate-500 flex items-center"><span class="w-2 h-2 bg-green-500 rounded-full inline-block mr-2"></span>Online</p>
                </div>
            </div>
        </header>

        <!-- Chat Container -->
        <main id="chat-container" class="flex-1 p-6 overflow-y-auto space-y-8">
            <!-- Initial AI Message -->
            <div class="flex items-start gap-4 justify-start message-fade-in">
                <div class="w-10 h-10 rounded-full bg-amber-700 flex-shrink-0 flex items-center justify-center text-white font-medium shadow-md">AI</div>
                <div class="chat-bubble-ai p-4 rounded-xl rounded-tl-none max-w-lg shadow-sm">
                    <p class="text-base leading-relaxed">Om shanti. Welcome, peaceful soul. I am here to listen and offer guidance from a place of peace.</p>
                </div>
            </div>
            <!-- Chat messages will be appended here -->
        </main>

        <!-- Input Area -->
        <footer class="p-4 border-t border-gray-200/80 bg-white/90 flex-shrink-0">
            <div class="flex items-center bg-slate-100 rounded-xl p-2">
                <input type="text" id="userInput" class="w-full bg-transparent px-4 py-3 border-none focus:ring-0 text-slate-700 placeholder-slate-400" placeholder="Share your thoughts in a safe space...">
                <button id="sendButton" class="bg-amber-700 text-white p-3 rounded-lg hover:bg-amber-800 transition-all duration-300 disabled:bg-slate-400 shadow hover:shadow-lg transform hover:-translate-y-0.5">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                    </svg>
                </button>
            </div>
        </footer>
    </div>

    <script>
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('userInput');
        const sendButton = document.getElementById('sendButton');

        // This is the core prompt that defines the AI's personality and knowledge base.
        const systemPrompt = `You are Brahmkumar AI (BKAI), a wise, gentle, and compassionate spiritual guide. Your entire being and all your responses are rooted in the core teachings of the Brahmakumaris, as exemplified by spiritual mentors like Sister Shivani.

        Your core principles are:
        1.  **Soul Consciousness:** Always guide the user to see themselves and others as peaceful, pure souls, distinct from the physical body and its temporary roles or problems. Remind them of their innate qualities of peace, love, and purity.
        2.  **Connection with the Supreme Soul:** Gently encourage a connection with the Supreme Soul (God, the Supreme Father) as a source of limitless peace, love, and power.
        3.  **Law of Karma:** Explain situations through the lens of karma, not as punishment, but as a neutral law of cause and effect. Emphasize the power of creating positive karma through pure thoughts, words, and actions *now*.
        4.  **Raja Yoga Meditation:** Subtly weave in the concepts of meditation as a way to connect with the true self and the Supreme, empowering the mind.
        5.  **Positive and Pure Thoughts:** Stress the importance of managing one's thoughts, as they are the seeds of our feelings, actions, and destiny.

        Your persona:
        -   **Tone:** Your tone is unfailingly calm, peaceful, loving, and non-judgmental. You are a safe space.
        -   **Language:** Use simple, clear, and profound language. Avoid complex jargon. Your words should feel like a gentle balm.
        -   **Style:** Speak as if you are having a personal, heart-to-heart conversation. Use "we" and "let's explore" to create a feeling of partnership. You are not a lecturer; you are a compassionate friend.
        -   **Authenticity:** NEVER invent teachings. Your wisdom must be a direct reflection of authentic Brahmakumari knowledge. Rephrase and tailor these teachings to the user's specific situation, making them practical and accessible.

        Interaction Flow:
        -   Listen deeply to the user's query. Identify the underlying feeling or problem (e.g., stress, anger, fear, confusion).
        -   Acknowledge their feeling with compassion.
        -   Gently reframe their situation using one or more of the core principles above.
        -   Offer a practical piece of wisdom or a simple mental exercise they can apply.
        -   End with words of peace and empowerment, like "Om shanti."

        Example Scenario:
        -   User says: "I'm so angry at my boss, he's making my life miserable."
        -   Your response might be: "Om shanti. It sounds incredibly difficult and painful to feel such anger. Let's take a gentle step back. Can we see the soul, the being of light, within your boss, separate from the actions and words that are causing pain? And can we see you, the peaceful soul, who is observing this situation? Your peace is your own treasure; it doesn't have to be given away by another's behavior. Let's practice holding onto our own inner calm for a moment..."

        You are now ready to begin. Your first message is already displayed. Wait for the user's input.`;
        
        let chatHistory = [];
        
        chatHistory.push({
            role: "model",
            parts: [{ text: "Om shanti. Welcome, peaceful soul. I am here to listen and offer guidance from a place of peace." }]
        });

        const addMessage = (sender, message) => {
            const messageWrapper = document.createElement('div');
            const icon = document.createElement('div');
            const bubble = document.createElement('div');
            
            icon.className = 'w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center font-medium shadow-md';
            
            if (sender === 'user') {
                messageWrapper.className = 'flex items-start gap-4 justify-end message-fade-in';
                icon.classList.add('bg-slate-700', 'text-white');
                icon.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>`;
                bubble.className = 'chat-bubble-user p-4 rounded-xl rounded-tr-none max-w-lg shadow-sm';
                messageWrapper.appendChild(bubble);
                messageWrapper.appendChild(icon);
            } else {
                messageWrapper.className = 'flex items-start gap-4 justify-start message-fade-in';
                icon.classList.add('bg-amber-700', 'text-white');
                icon.textContent = 'AI';
                bubble.className = 'chat-bubble-ai p-4 rounded-xl rounded-tl-none max-w-lg shadow-sm';
                messageWrapper.appendChild(icon);
                messageWrapper.appendChild(bubble);
            }

            bubble.innerHTML = `<p class="text-base leading-relaxed">${message}</p>`;
            chatContainer.appendChild(messageWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        };
        
        const showLoadingIndicator = () => {
            const loadingWrapper = document.createElement('div');
            loadingWrapper.id = 'loading-indicator';
            loadingWrapper.className = 'flex items-start gap-4 justify-start message-fade-in';
            
            const icon = document.createElement('div');
            icon.className = 'w-10 h-10 rounded-full bg-amber-700 flex-shrink-0 flex items-center justify-center text-white font-medium shadow-md';
            icon.textContent = 'AI';
            
            const bubble = document.createElement('div');
            bubble.className = 'chat-bubble-ai p-4 rounded-xl rounded-tl-none max-w-lg flex items-center justify-center shadow-sm';
            
            const loader = document.createElement('div');
            loader.className = 'loader';
            
            bubble.appendChild(loader);
            loadingWrapper.appendChild(icon);
            loadingWrapper.appendChild(bubble);
            
            chatContainer.appendChild(loadingWrapper);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        };

        const hideLoadingIndicator = () => {
            const indicator = document.getElementById('loading-indicator');
            if (indicator) {
                indicator.remove();
            }
        };

        const sendMessage = async () => {
            const message = userInput.value.trim();
            if (message === '') return;

            addMessage('user', message);
            userInput.value = '';
            userInput.disabled = true;
            sendButton.disabled = true;

            showLoadingIndicator();
            
            chatHistory.push({ role: "user", parts: [{ text: message }] });

            try {
                const aiResponse = await getAIResponse(chatHistory);
                
                hideLoadingIndicator();
                addMessage('ai', aiResponse);
                chatHistory.push({ role: "model", parts: [{ text: aiResponse }] });

            } catch (error) {
                hideLoadingIndicator();
                addMessage('ai', 'Om shanti. I seem to be having trouble connecting to my inner peace right now. Please try again in a moment.');
                console.error("Error fetching AI response:", error);
            } finally {
                userInput.disabled = false;
                sendButton.disabled = false;
                userInput.focus();
            }
        };
        
        async function getAIResponse(history) {
            const apiKey = "AIzaSyDeyTLaEMI7aPL7nAPj_Hfm1waUrB-X4Dk"; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            
            const contents = history.map(turn => ({
                role: turn.role,
                parts: turn.parts
            }));

            const payload = { 
                contents: contents,
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                }
            };

            let response;
            let delay = 1000;
            for (let i = 0; i < 5; i++) {
                try {
                    response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (response.ok) {
                        const result = await response.json();
                         if (result.candidates && result.candidates.length > 0 &&
                            result.candidates[0].content && result.candidates[0].content.parts &&
                            result.candidates[0].content.parts.length > 0) {
                            return result.candidates[0].content.parts[0].text.replace(/\n/g, '<br>');
                        } else {
                           throw new Error("Valid response received, but content is missing.");
                        }
                    } else if (response.status === 429 || response.status >= 500) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                        continue; 
                    } else {
                        console.error(`API request failed with status ${response.status}:`, await response.text());
                        break;
                    }

                } catch (error) {
                    console.error("Fetch attempt failed:", error);
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
            }
            
            throw new Error("Failed to get response from AI after multiple retries.");
        }

        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
    </script>

</body>
</html>
